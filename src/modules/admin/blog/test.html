<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Full Blog Feed</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #262627;
      margin: 0;
      padding: 20px;
      color: #dfdede;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      color: #2c3e50;
      font-weight: 600;
      font-size: 2.2rem;
      position: relative;
      padding-bottom: 15px;
    }

    h1:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: linear-gradient(90deg, #3498db, #9b59b6);
      border-radius: 3px;
    }

    .feed-grid {
      display: flex;
      flex-direction: column;
      gap: 30px;
      max-width: 650px;
      margin: auto;
    }

    .blog-card {
      background: #111111;
      color: white;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      padding: 25px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .blog-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
    }

    .blog-title {
      font-size: 1.5rem;
      margin: 0 0 15px 0;
      color: #2c3e50;
      font-weight: 600;
      line-height: 1.3;
    }

    .hashtags {
      color: #7f8c8d;
      font-size: 0.85rem;
      margin-bottom: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .hashtags span {
      color: #3498db;
      font-weight: 500;
    }

    .categories {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .categories span {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      color: #4a5568;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .blog-content-block {
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .blog-content-block:last-child {
      margin-bottom: 0;
    }

    .blog-content-block p {
      font-size: 1rem;
      color: #4a5568;
      margin: 0 0 15px 0;
    }

    .blog-content-block img,
    .blog-content-block video {
      width: 100%;
      max-height: 400px;
      object-fit: cover;
      border-radius: 8px;
      margin: 15px 0;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .blog-content-block img:hover,
    .blog-content-block video:hover {
      transform: scale(1.01);
    }

    .blog-content-block video {
      background: #000;
    }

    @media (max-width: 768px) {
      .feed-grid {
        max-width: 100%;
        padding: 0 10px;
      }
      
      .blog-card {
        padding: 20px;
      }
      
      .blog-title {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <h1>All Blogs</h1>
  <div id="blog-feed" class="feed-grid"></div>

  <script>
    const API_URL = 'http://localhost:4000/api/admin/blog';
    const MEDIA_BASE = 'http://192.168.4.2:9000/social-media'; // This is the correct base for full path

    async function loadAllBlogs() {
      try {
        const res = await fetch(API_URL);
        const blogs = await res.json();

        const feed = document.getElementById('blog-feed');
        feed.innerHTML = '';

        blogs.forEach(blog => {
          const card = document.createElement('div');
          card.classList.add('blog-card');

          // Title
          const title = document.createElement('h2');
          title.className = 'blog-title';
          title.textContent = blog.title || 'Untitled';
          card.appendChild(title);

          // Hashtags
          const hashtags = document.createElement('div');
          hashtags.className = 'hashtags';
          if (blog.hashtags && blog.hashtags.length > 0) {
            blog.hashtags.forEach(tag => {
              const span = document.createElement('span');
              span.textContent = `#${tag}`;
              hashtags.appendChild(span);
            });
          }
          card.appendChild(hashtags);

          // Categories
          const catContainer = document.createElement('div');
          catContainer.className = 'categories';
          (blog.categories || []).forEach(cat => {
            const tag = document.createElement('span');
            tag.textContent = cat.name;
            catContainer.appendChild(tag);
          });
          card.appendChild(catContainer);

          // Content blocks
          (blog.contents || []).forEach(content => {
            const block = document.createElement('div');
            block.className = 'blog-content-block';

            if (content.content_type === 'text') {
              const p = document.createElement('p');
              p.textContent = content.content;
              block.appendChild(p); }
            else if (content.content_type === 'media') {
              const mediaUrl = `${MEDIA_BASE}${content.content}`.replace(/([^:]\/)\/+/g, '$1'); // Correct URL format

              const ext = mediaUrl.split('.').pop().toLowerCase(); // Extract file extension

              let mediaElement;  // Declare the media element

              // Check if it's an image (e.g., jpg, png, webp, etc.)
              if (['jpg', 'jpeg', 'png', 'webp', 'gif', 'bmp'].includes(ext)) {
                mediaElement = document.createElement('img');
                mediaElement.src = mediaUrl;
                mediaElement.alt = 'Image';
                mediaElement.onerror = () => {
                  mediaElement.alt = 'Image failed to load';
                  mediaElement.style.opacity = 0.5;
                };
              }
              // Check if it's a video (e.g., mp4, avi, mov, etc.)
              else if (['mp4', 'avi', 'mov', 'mkv', 'webm'].includes(ext)) {
                mediaElement = document.createElement('video');
                mediaElement.src = mediaUrl;
                mediaElement.controls = true;
                mediaElement.alt = 'Video';
              }

              // If a media element was created, append it to the block
              if (mediaElement) {
                block.appendChild(mediaElement);
              }
            }

            card.appendChild(block);
          });

          feed.appendChild(card);
        });

      } catch (err) {
        console.error("Failed to load blogs:", err);
        document.getElementById('blog-feed').innerHTML = `
          <div class="blog-card" style="text-align: center; color: #e74c3c;">
            <p>Error loading blogs. Please try again later.</p>
          </div>
        `;
      }
    }

    loadAllBlogs();
  </script>
</body>
</html>